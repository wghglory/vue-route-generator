#!/usr/bin/env node

const program = require('commander');
const symbols = require('log-symbols');
const chalk = require('chalk');
const path = require('path');

const folderDir = '../vue-template';

// console.log(process.argv)
program.action(() => {
  console.log('refresh .... ');
});
program.parse(process.argv);

const fs = require('fs');
const handlebars = require('handlebars');

// è·å–é¡µé¢åˆ—è¡¨
const list = fs
  .readdirSync(path.resolve(folderDir, './src/views'))
  .filter((v) => v !== 'Home.vue')
  .map((v) => ({
    name: v.replace('.vue', '').toLowerCase(),
    file: v,
  }));

// ç”Ÿæˆè·¯ç”±å®šä¹‰
compile(
  {
    list,
  },
  path.resolve(folderDir, './src/router.js'),
  path.resolve(folderDir, './template/router.js.hbs'),
);

// ç”Ÿæˆèœå•
compile(
  {
    list,
  },
  path.resolve(folderDir, './src/App.vue'),
  path.resolve(folderDir, './template/App.vue.hbs'),
);

/**
 * ç¼–è¯‘æ¨¡æ¿æ–‡ä»¶
 * @param meta æ•°æ®å®šä¹‰
 * @param filePath ç›®æ ‡æ–‡ä»¶è·¯å¾„
 * @param templatePath æ¨¡æ¿æ–‡ä»¶è·¯å¾„
 */
function compile(meta, filePath, templatePath) {
  if (fs.existsSync(templatePath)) {
    const content = fs.readFileSync(templatePath).toString();
    const result = handlebars.compile(content)(meta);
    fs.writeFileSync(filePath, result);
  }
  console.log(symbols.success, chalk.green(`ğŸš€${filePath} åˆ›å»ºæˆåŠŸ`));
}
